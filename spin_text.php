<?php

function spin_text($textToSpin, $soft_name=''){

	if(!empty($soft_name)){
		preg_match_all('/(\pL{4,})/iu', $soft_name, $m);
		$words_to_ignore = implode(',', $m[1]);
	}

	$url = 'https://api.spinbot.com';
	$header = array();

	// Required header:
	$spinbotApiKey = SPINBOT_API_KEY;
	$header[] = "x-auth-key:$spinbotApiKey";

	// optional header values
	$header[] = 'x-spin-cap-words:false';
	//$header[] = "x-words-to-skip:$words_to_ignore";
	$header[] = 'x-min-percent-change-per-sentence:any';

	// Execute cURL request, get response
	$ch = curl_init();
	curl_setopt($ch, CURLOPT_URL, $url);
	curl_setopt($ch, CURLOPT_POST, true);
	curl_setopt($ch, CURLOPT_POSTFIELDS, $textToSpin);
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
	curl_setopt($ch, CURLOPT_HEADER, true);
	curl_setopt($ch, CURLOPT_HTTPHEADER, $header);
	$response = curl_exec($ch); 

	$header_size = curl_getinfo($ch, CURLINFO_HEADER_SIZE);
	$response = substr($response, $header_size);

	curl_close($ch);

	return trim($response);
}
